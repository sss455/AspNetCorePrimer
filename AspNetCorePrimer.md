## 目次
* 第1章 ASP.NET Core MVCの概要
* 第2章 ASP.NET Core MVCプロジェクト
* 第3章 スキャフォールディングの利用
* 第4章 Modelの活用
* 第5章 Viewの活用
* 第6章 Controllerの活用
* 第7章 List-Detailの関係
* 第8章 複数Viewの活用
* 第9章 Web API
* 第10章 状態管理
* 第11章 ルーティング
* 第12章 認証
* 第13章 シングルページアプリケーション（SPA）
* 第14章 Azureへデプロイ
* 付録A マルチ環境ともう1つのASP.NET Coreアプリ

<hr>

<br><br>

### 第3章 スキャフォールディングの利用
・データベースにある既存のテーブルに対して検索や更新を行うためのViewとControllerを一気に作成する機能。

**[手順の流れ]**
　(1) 新しいプロジェクトを作成する
　(2) データベースユーザーを作成
　(3) データベースを作成する
　(4) Personテーブルを作成する
　(5) Personテーブルのデータを作成する
　(6) NuGetパッケージを追加する
　(7) Modelクラスを自動作成する
　(8) Program.cs／appsetting.jsonを修正する
　(9) スキャフォールディングを実行する（View／Controllerの自動生成）
　(10) 動作確認


<hr>

**【具体的な手順】**

**(1) 新しいプロジェクトを作成する**
　　テンプレート　：「ASP.NET Core Web アプリ（Model-View-Controller）」
　　プロジェクト名：「SampleMvc」

**(2) データベースユーザーを作成**
```
※PostgreSQLの場合
> createuser --interactive mvcuser -U postgres
新しいロールをスーパーユーザーにしますか？ (y/n) n
新しいロールに対してデータベースを作成する権限を与えますか？ (y/n) n
新しいロールに対して別のロールを作成する権限を与えますか？ (y/n) n
パスワード:
```

**(3) データベースを作成する**
```
※PostgreSQLの場合
> createdb -O mvcuser mvcdb -U postgres
パスワード:
```
<font color="blue">-Oオプション</font>を使い、データベースの所有者としてmvcuserを指定する。

**・データベースの作成確認**
```
> psql -l -U postgres
ユーザー postgres のパスワード:
                                                                        データベース一覧
      名前       |  所有者  | エンコーディング | ロケールプロバイダー |      照合順序      | Ctype(変換演算子)  | ロケール | ICUルール: |     アクセス権限
-----------------+----------+------------------+----------------------+--------------------+--------------------+----------+------------+-----------------------
 mvcdb           | mvcuser  | UTF8             | libc                 | Japanese_Japan.932 | Japanese_Japan.932 |          |            |
 pgadmin         | postgres | UTF8             | libc                 | Japanese_Japan.932 | Japanese_Japan.932 |          |            |
 postgres        | postgres | UTF8             | libc                 | Japanese_Japan.932 | Japanese_Japan.932 |          |            |
 template0       | postgres | UTF8             | libc                 | Japanese_Japan.932 | Japanese_Japan.932 |          |            | =c/postgres          +
                 |          |                  |                      |                    |                    |          |            | postgres=CTc/postgres
 template1       | postgres | UTF8             | libc                 | Japanese_Japan.932 | Japanese_Japan.932 |          |            | =c/postgres          +
                 |          |                  |                      |                    |                    |          |            | postgres=CTc/postgres
 test_tablespace | postgres | UTF8             | libc                 | Japanese_Japan.932 | Japanese_Japan.932 |          |            |
(6 行)
```

**・ロールの追加**
~~# CREATE ROLE mvcuser WITH PASSWORD 'mvcuser';~~
~~# ALTER ROLE mvcuser LOGIN;~~
```
> psql -U postgres
ユーザー postgres のパスワード:

psql (18.1)
"help"でヘルプを表示します。

postgres=# ALTER ROLE mvcuser WITH PASSWORD 'mvcuser';
```

**(4) Personテーブルを作成する**
```sql
-- ■ SQLServerの場合
CREATE TABLE Person (
    id   int         IDENTITY(1, 1) NOT NULL,
    name varchar(50) NOT NULL,
    age  int         NOT NULL,
  CONSTRAINT PK_person1 PRIMARY KEY CLUSTERED
  (
      id ASC
  )
);

-- ■ PostgreSQLの場合
CREATE TABLE person (
    id   integer     GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    name varchar(50) NOT NULL,
    age  integer     NOT NULL,
    CONSTRAINT pk_person1 PRIMARY KEY (id)
);
```

**(5) Personテーブルのデータを作成する**
```sql
INSERT INTO Person(name, age) VALUES('matsuda', 50);
INSERT INTO Person(name, age) VALUES('yamada',  40);
INSERT INTO Person(name, age) VALUES('sato',    30);
```

**(6) NuGetパッケージを追加する**
<u>■ SQLServerの場合</u>
 ・Microsoft.EntityFrameworkCore.Design
 ・Microsoft.EntityFrameworkCore.SqlServer
 ・Microsoft.EntityFrameworkCore.Tools

<u>■ PostgreSQLの場合</u>
 ・Microsoft.EntityFrameworkCore.Design
 ・Microsoft.EntityFrameworkCore.SqlServer
 ・Microsoft.EntityFrameworkCore.Tools
 ・Microsoft.VisualStudio.Web.CodeGeneration.Design
 ・Npgsql.EntityFrameworkCore.PostgreSQL
※「Microsoft.EntityFrameworkCore.SqlServer」はスキャフォールディングで必要になる場合があるとのこと。

**(7) Modelクラスを自動作成する**
> **dotnet ef コマンド**　<font color="red">※SQLServerの場合</font>
> ```sh
> dotnet ef dbcontext scaffold {接続文字列} Microsoft.EntityFrameworkCore.> SqlServer -o {出力フォルダー}
> ```
> 
> **(例)**
> ```sh
> dotnet ef dbcontext scaffold "Server=.;Database=mvcdb;Trusted_Connection=True;TrustServerCertificate=Yes" Microsoft.EntityFrameworkCore.SqlServer -o Models
> ```

> **dotnet ef コマンド**　<font color="red">※PostgreSQLの場合</font>
> ```sh
> > dotnet ef dbcontext scaffold "Server=localhost; Port=5432; Database=mvcdb; Username=mvcuser; Password=mvcuser" Npgsql.EntityFrameworkCore.PostgreSQL -o Models
> Build started...
> Build succeeded.
> To protect potentially sensitive information in your connection string, you should move it out of source code. 
> You can avoid scaffolding the connection string by using the Name= syntax to read it from configuration - see https://go.microsoft.com/fwlink/?linkid=2131148. 
> For more guidance on storing connection strings, see https://go.microsoft.com/fwlink/?LinkId=723263.
> 　↓
> (訳)
> 接続文字列内の機密性の高い情報を保護するため、ソースコードから移動させる必要があります。
> Name=構文を使用して設定から読み込むことで、接続文字列のスケルトン生成を回避できます。
> 詳細は https://go.microsoft.com/fwlink/?linkid=2131148 を参照してください。
> 接続文字列の保存に関する詳細なガイダンスについては、https://go.microsoft.com/fwlink/?LinkId=723263 を参照してください。
> 　↓
> > dotnet ef dbcontext scaffold "Name=MvcdbContext" Npgsql.EntityFrameworkCore.PostgreSQL -o Models
> Build started...
> Build succeeded.
> ```

**(8) Program.cs／appsetting.jsonを修正する**
> **Program.cs**
> ```cs
> // ■ SQLServerの場合
> var builder = WebApplication.CreateBuilder(args);
> // Add services to the container.
> builder.Services.AddControllersWithViews();
> builder.Services.AddDbContext<MvcdbContext>(options =>
>     options.UseSqlServer(builder.Configuration.GetConnectionString("DefaultConnection")));
> ```
> ```cs
> // ■ PostgreSQLの場合
> var builder = WebApplication.CreateBuilder(args);
> // Add services to the container.
> builder.Services.AddControllersWithViews();
> builder.Services.AddDbContext<MvcdbContext>(options =>
>     // ※Postgresqlの場合は、UseNpgsqlメソッドを使う
>     options.UseNpgsql(builder.Configuration.GetConnectionString("MvcdbContext")));
> ```

> **appsetting.json**
> ```json
> ■ SQLServerの場合
>   "ConnectionStrings": {
>     "DefaultConnection": "Server=.; Database=mvcdb; Trusted_Connection=True; > TrustServerCertificate=Yes"
>   },
> ```
> ```json
> ■ PostgreSQLの場合
>   "ConnectionStrings": {
>     "MvcdbContext": "Server=localhost; Port=5432; Database=mvcdb; Username=mvcuser; > Password=mvcuser"
>   },
> ```

**(9) スキャフォールディングを実行する（View／Controllerの自動生成）**
**(10) 動作確認**

<br>





